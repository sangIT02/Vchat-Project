<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VChat Trang chủ</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="icon" type="image/png" href="../images/logo.png" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link href="../CSS/main.css" rel="stylesheet" />
    <link rel="stylesheet" href="../CSS/darkmode.css" />
    <link rel="stylesheet" href="../CSS/mess.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    />
    <style>
      body {
        background-color: #c4ecf7;
        transition: background-color 0.3s, color 0.3s;
      }

      .post {
        background-color: white;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        transition: background-color 0.3s;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <nav
      class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top"
    >
      <div
        class="container-fluid d-flex flex-nowrap align-items-center justify-content-between"
      >
        <!-- LOGO + SEARCH -->
        <div class="d-flex align-items-center flex-grow-1 flex-md-grow-0">
          <!-- Logo -->
          <a href="index.html" class="me-2">
            <img
              class="rounded-circle"
              style="width: 40px; height: 40px"
              src="../images/logo.png"
              alt="logo"
            />
          </a>

          <!-- Tìm kiếm (ẩn trên mobile) -->
          <!-- Form tìm kiếm cho màn hình lớn -->
          <form
            class="d-none d-lg-flex ms-2 position-relative"
            style="width: 250px"
          >
            <i
              class="bi bi-search text-secondary position-absolute top-50 start-0 translate-middle-y ms-3"
            ></i>
            <input
              type="search"
              class="form-control form-control-sm rounded-5 border-0 ps-5 shadow-sm"
              placeholder="Tìm kiếm"
              style="background-color: #f0f2f5; height: 35px; width: 240px"
            />
          </form>

          <!-- Nút tìm kiếm cho thiết bị nhỏ -->
          <button
            class="btn btn-light d-lg-none ms-2"
            id="mobileSearchBtn"
            type="button"
            onclick="toggleMobileSearch()"
          >
            <i class="bi bi-search fs-5 text-dark"></i>
          </button>
        </div>

        <!-- MENU ICONS GIỮA (ẩn trên mobile, hoặc bạn có thể điều chỉnh thành collapse) -->
        <div class="d-none d-lg-flex mx-auto" id="menuTabs">
          <div class="d-flex justify-content-center text-center">
            <div class="menu-item px-5 active" data-link="#">
              <a href="#"><i class="bi bi-house-door-fill fs-4 active"></i></a>
              <div class="indicator"></div>
            </div>
            <div class="menu-item px-5" data-link="friend.html">
              <a><i class="bi bi-people-fill fs-4"></i></a>
              <div class="indicator"></div>
            </div>
            <div class="menu-item px-5" data-link="/">
              <a href="reel.html"><i class="bi bi-play-btn-fill fs-4"></i></a>
              <div class="indicator"></div>
            </div>
            <div class="menu-item px-5" data-link="/">
              <a href="#"><i class="bi bi-bell-fill fs-4"></i></a>
              <div class="indicator"></div>
            </div>
          </div>
        </div>

        <!-- ICONS + AVATAR -->
        <div class="d-flex align-items-center gap-2 mt-2 mt-lg-0">
          <!-- App grid -->
          <!-- Icon Grid -->
          <div
            id="menuToggle"
            class="rounded-circle bg-secondary-subtle d-flex justify-content-center align-items-center"
            style="
              width: 40px;
              height: 40px;
              cursor: pointer;
              position: relative;
            "
          >
            <i class="bi bi-grid-3x3-gap-fill fs-5 text-dark"></i>
          </div>

          <!-- Dropdown menu -->
          <div id="menuDropdown" class="dd-panel" style="display: none">
            <div class="dd-head">
              <span class="dd-title">Menu</span>
            </div>

            <div class="dd-list">
              <!-- Post -->
              <button class="dd-item" type="button" onclick="openPostModal()">
                <span
                  class="dd-icon"
                  style="--grad: linear-gradient(135deg, #ff9a9e, #fad0c4)"
                >
                  <i class="bi bi-file-post"></i>
                </span>
                <span class="dd-label">Bài viết</span>
              </button>

              <!-- Story -->
              <button
                class="dd-item"
                type="button"
                onclick="window.location.href='tao_tin.html'"
              >
                <span
                  class="dd-icon"
                  style="--grad: linear-gradient(135deg, #a18cd1, #fbc2eb)"
                >
                  <i class="bi bi-book-half"></i>
                </span>
                <span class="dd-label">Tin</span>
              </button>

              <!-- Reel -->
              <button
                class="dd-item"
                type="button"
                onclick="window.location.href='tao_tin.html'"
              >
                <span
                  class="dd-icon"
                  style="--grad: linear-gradient(135deg, #84fab0, #8fd3f4)"
                >
                  <i class="bi bi-fast-forward-btn-fill"></i>
                </span>
                <span class="dd-label">Reel</span>
              </button>
              <button
                class="dd-item dd-logout"
                type="button"
                onclick="logoutUser()"
              >
                <span
                  class="dd-icon"
                  style="--grad: linear-gradient(135deg, #ff6b6b, #ff4757)"
                >
                  <i class="bi bi-box-arrow-right"></i>
                </span>
                <span class="dd-label">Đăng xuất</span>
              </button>
              <!-- Dark mode -->
              <div class="dd-item dd-item-static">
                <span
                  class="dd-icon"
                  style="--grad: linear-gradient(135deg, #ecf0f1, #bdc3c7)"
                >
                  <i class="bi bi-moon-fill"></i>
                </span>
                <div class="dd-col">
                  <span class="dd-label">Dark mode</span>
                  <div class="dd-radio">
                    <label
                      ><input
                        type="radio"
                        name="darkmode"
                        value="off"
                        checked
                      />
                      Tắt</label
                    >
                    <label
                      ><input type="radio" name="darkmode" value="on" />
                      Bật</label
                    >
                  </div>
                </div>
              </div>
            </div>

            <hr class="dd-divider" />

            <!-- Logout -->
          </div>

          <!-- Messenger -->
          <div
            id="messengerBtn"
            class="rounded-circle bg-secondary-subtle d-flex justify-content-center align-items-center"
            style="width: 40px; height: 40px; cursor: pointer"
          >
            <i class="bi bi-messenger fs-5 text-dark"></i>
          </div>

          <!-- Sidebar Chat -->
          <div
            id="chatSidebar"
            class="chat-sidebar position-fixed top-0 end-0 bg-white dark-mode-bg p-3 shadow"
            style="
              width: 380px;
              height: 100vh;
              transform: translateX(100%);
              transition: transform 0.3s ease;
              z-index: 1050;
            "
          >
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h4 class="mb-0 fw-bold">Tin nhắn</h4>
              <div class="d-flex align-items-center">
                <div
                  class="rounded-circle icon-wrapper d-flex justify-content-center align-items-center me-2"
                  style="width: 30px; height: 30px; cursor: pointer"
                >
                  <i class="bi bi-arrows-fullscreen"></i>
                </div>
                <button
                  class="btn-close btn-close-custom rounded-circle"
                  onclick="toggleChatSidebar()"
                ></button>
              </div>
            </div>

            <!-- Tìm kiếm -->
            <form
              class="d-none d-md-flex mb-3"
              style="position: relative; width: 100%"
            >
              <i
                class="bi bi-search text-secondary position-absolute top-50 start-0 translate-middle-y ms-3"
              ></i>
              <input
                type="search"
                class="form-control form-control-sm rounded-5 border-0 ps-5 shadow-sm"
                placeholder="Search"
                style="background-color: #f0f2f5; height: 35px; width: 100%"
              />
            </form>

            <!-- Một dòng chat -->
            <div class="d-flex align-items-center gap-2 mb-3 chat-hover">
              <img
                src="../images/OIP.jpg"
                class="rounded-circle"
                style="width: 48px; height: 48px"
              />
              <div>
                <div class="fw-semibold">Hoàng Đức</div>
                <div class="text-muted" style="font-size: 13px">
                  sent a photo · 4h
                </div>
              </div>
            </div>
          </div>

          <!-- Bell -->
          <!-- 🔔 Nút chuông -->
          <div
            id="notificationBell"
            class="rounded-circle bg-secondary-subtle d-flex justify-content-center align-items-center"
            style="
              width: 40px;
              height: 40px;
              cursor: pointer;
              position: relative;
            "
          >
            <i class="bi bi-bell fs-5 text-dark"></i>
            <span
              id="notificationBadge"
              class="notification-badge d-none"
              style="
                position: absolute;
                top: -4px;
                right: -4px;
                background: red;
                color: white;
                font-size: 10px;
                width: 16px;
                height: 16px;
                border-radius: 50%;
                text-align: center;
                line-height: 16px;
              "
              >0</span
            >
          </div>
          <!-- Dropdown thông báo -->
          <div
            id="notificationDropdown"
            class="dropdown-menu p-3 shadow"
            style="
              display: none;
              position: absolute;
              top: 60px;
              right: 20px;
              width: 360px;
              max-height: 400px;
              overflow-y: auto;
              z-index: 9999;
            "
          >
            <h4 style="font-weight: bold">Thông báo</h4>
            <div id="notificationList"></div>
          </div>

          <!-- Avatar -->
          <div
            class="rounded-circle d-flex align-items-center justify-content-center position-relative"
            style="width: 40px; height: 40px; overflow: hidden; cursor: pointer"
            onclick="window.location.href='profile.html'"
          >
            <img
              src="../images/OIP.jpg"
              class="rounded-circle userAvatar"
              alt="avatar"
              style="
                width: 40px;
                height: 40px;
                border: 1px solid #65676b; /* viền trắng */
                box-shadow: 0 0 0 1px #ccc; /* outline mờ xám */
              "
            />
          </div>

          <!-- Dark mode -->
        </div>
      </div>
    </nav>

    <!-- Main Layout -->
    <div class="container-fluid mt-3">
      <div class="row justify-content-center">
        <!-- Sidebar trái -->
        <div class="col-lg-3 d-none d-lg-block">
          <div
            class="left-sidebar py-2 rounded full-height-sidebar"
            style="background-color: transparent"
          >
            <!-- User avatar -->
            <div
              class="d-flex align-items-center py-2 user-hover rounded-2 gap-2"
              onclick="window.location.href='profile.html'"
            >
              <img
                src="../images/IMG_2007.JPG"
                alt=""
                class="rounded-circle userAvatar"
                style="width: 40px; height: 40px; border: 1px solid #bdc3c7"
              />
              <a
                href="profile.html"
                class="d-block text-decoration-none text-dark ms-2 userName"
                style="font-weight: bold"
              ></a>
            </div>

            <!-- SocioAI -->
            <div
              class="d-flex align-items-center py-2 user-hover rounded-2 gap-2"
              onclick="window.location.href='/chatbot.html'"
            >
              <div
                style="
                  width: 40px;
                  height: 40px;
                  padding: 3px;
                  background: linear-gradient(
                    45deg,
                    #00f,
                    #0ff,
                    #0f0,
                    #ff0,
                    #f00
                  );
                  border-radius: 50%;
                  cursor: pointer;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                "
              >
                <div
                  style="
                    width: 100%;
                    height: 100%;
                    background-color: white;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                  "
                >
                  <img
                    src="../images/OIP.webp"
                    alt="Trợ lý ảo"
                    style="
                      width: 100%;
                      height: 100%;
                      border-radius: 50%;
                      object-fit: cover;
                    "
                  />
                </div>
              </div>
              <a
                href="chatbot.html"
                class="text-decoration-none text-dark fw-bold flex-grow-1"
                >SocioAI</a
              >
            </div>

            <!-- Friends -->
            <div
              class="d-flex align-items-center py-2 user-hover rounded-2 gap-2"
            >
              <div
                class="d-flex align-items-center justify-content-center"
                style="width: 40px; height: 40px"
              >
                <i
                  class="fa-solid fa-user-group"
                  style="
                    font-size: 20px;
                    background: linear-gradient(45deg, #0984e3, #81ecec);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                  "
                ></i>
              </div>
              <a
                href="friend.html"
                class="text-decoration-none text-dark fw-bold flex-grow-1"
                >Bạn bè</a
              >
            </div>

            <!-- Save -->
            <div
              class="d-flex align-items-center py-2 user-hover rounded-2 gap-2"
            >
              <div
                class="d-flex align-items-center justify-content-center"
                style="width: 40px; height: 40px"
              >
                <i
                  class="bi bi-bookmark-check-fill"
                  style="
                    font-size: 25px;
                    background: linear-gradient(45deg, #e84393, #a29bfe);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                  "
                ></i>
              </div>
              <a
                href="friend.html"
                class="text-decoration-none text-dark fw-bold flex-grow-1"
                >Đã lưu</a
              >
            </div>

            <!-- Video -->
            <div
              class="d-flex align-items-center py-2 user-hover rounded-2 gap-2"
            >
              <div
                class="d-flex align-items-center justify-content-center"
                style="width: 40px; height: 40px"
              >
                <i
                  class="bi bi-youtube"
                  style="
                    font-size: 25px;
                    background: linear-gradient(45deg, #0984e3, #74b9ff);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                  "
                ></i>
              </div>
              <a
                href="friend.html"
                class="text-decoration-none text-dark fw-bold flex-grow-1"
                >Video</a
              >
            </div>
            <div
              class="d-flex align-items-center py-2 user-hover rounded-2 gap-2"
            >
              <div
                class="d-flex align-items-center justify-content-center"
                style="width: 40px; height: 40px"
              >
                <i
                  class="bi bi-hourglass-split"
                  style="
                    font-size: 25px;
                    background: linear-gradient(45deg, #e84393, #6c5ce7);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                  "
                ></i>
              </div>
              <a
                href="story.html"
                class="text-decoration-none text-dark fw-bold flex-grow-1"
                >Tin</a
              >
            </div>
          </div>
        </div>

        <!-- News Feed (Giữa) -->
        <div class="col-sm-12 col-md-8 col-lg-6">
          <div class="d-flex flex-column align-items-center w-100">
            <div
              class="post shadow-sm p-3 rounded mb-3 bg-white dark-mode-bg w-100"
              style="max-width: 625px"
            >
              <div class="d-flex align-items-center mb-2">
                <img
                  src="../images/OIP.jpg"
                  class="rounded-circle me-2 userAvatar"
                  style="
                    width: 40px;
                    height: 40px;
                    border: 1px solid #bdc3c7;
                    cursor: pointer;
                  "
                  alt="Avatar"
                  onclick="window.location.href='profile.html'"
                />
                <button
                  class="form-control rounded-5 text-start"
                  style="background-color: #f0f2f5; height: 40px"
                  onclick="openPostModal()"
                >
                  Bạn đang nghĩ gì?
                </button>
              </div>
              <div class="d-flex justify-content-around mt-3 border-top pt-2">
                <button class="btn btn-light w-100 me-1 btn-action">
                  <i
                    class="bi bi-camera-reels-fill"
                    style="font-size: 20px; color: #e74c3c"
                  ></i>
                  Phát trực tiếp
                </button>
                <button
                  class="btn btn-light w-100 me-1 btn-action"
                  onclick="triggerFileInputAndOpenModal()"
                >
                  <i
                    class="bi bi-images"
                    style="font-size: 20px; color: #27ae60"
                  ></i>
                  Ảnh/Video
                </button>
                <button class="btn btn-light w-100 btn-action">
                  <i
                    class="bi bi-emoji-heart-eyes-fill"
                    style="font-size: 20px; color: #f39c12"
                  ></i>
                  Hoạt động
                </button>
              </div>
            </div>

            <!-- Story -->
            <div
              class="position-relative w-100 mb-3 rounded-3 story-wrapper"
              style="background-color: #e4e6eb; max-width: 625px"
            >
              <!-- Nút cuộn trái -->
              <button
                class="btn btn-dark position-absolute top-50 start-1 translate-middle-y z-1"
                id="scrollLeftBtn"
                style="
                  border-radius: 50%;
                  width: 40px;
                  height: 40px;
                  display: none;
                  color: #3b3c3e;
                "
              >
                <i class="bi bi-chevron-left" style="color: white"></i>
              </button>

              <!-- Container Story -->
              <div
                id="storyContainer"
                class="story-container d-flex gap-2 rounded-3"
                style="
                  overflow-x: auto;
                  white-space: nowrap;
                  scroll-behavior: smooth;
                  margin-top: 10px;
                "
              >
                <!-- Tạo Story -->
                <div
                  class="rounded-3 text-center story-item-wrapper pter"
                  style="
                    width: 120px;
                    height: 200px;
                    background-color: #252728;
                    flex: 0 0 auto;
                    margin-left: 5px;
                  "
                  onclick="makeStory()"
                >
                  <img
                    class="rounded-top-2 userAvatar"
                    src="../images/OIP.jpg"
                    alt=""
                    style="width: 100%; height: 150px; object-fit: cover"
                  />
                  <div
                    class="d-flex flex-column align-items-center justify-content-center"
                    style="height: 50px; margin-top: -10px"
                  >
                    <div
                      class="d-flex align-items-center justify-content-center bg-primary rounded-circle mb-1"
                      style="
                        width: 35px;
                        height: 35px;
                        border: 4px solid #242526;
                        box-shadow: 0 0 0 2px white;
                      "
                    >
                      <span
                        class="text-white fw-bold fs-3"
                        style="margin-bottom: 5px"
                        >+</span
                      >
                    </div>
                    <p class="mb-0 text-white" style="font-size: 13px">
                      Tạo tin
                    </p>
                  </div>
                </div>

                <!-- Danh sách Story -->
                <div id="storyList" class="d-flex gap-2 overflow-auto">
                  <!-- JS sẽ render các story tại đây -->
                </div>
              </div>

              <!-- Nút cuộn phải -->
              <button
                class="btn btn-dark position-absolute top-50 end-0 translate-middle-y z-1"
                id="scrollRightBtn"
                style="border-radius: 50%; width: 40px; height: 40px"
              >
                <i class="bi bi-chevron-right" style="color: white"></i>
              </button>
            </div>

            <!-- Container bài đăng -->
            <div
              id="postContainer"
              class="d-flex flex-column align-items-center w-100"
            ></div>
            <div id="loading" class="text-center py-3 d-none">
              <div class="spinner-border text-primary" role="status"></div>
            </div>
            <!-- Khung nhập bài đăng -->
            <!-- ... (giữ nguyên nội dung) ... -->

            <!-- Story -->
            <!-- ... (giữ nguyên nội dung) ... -->

            <!-- Container bài đăng -->
            <!-- ... (giữ nguyên nội dung) ... -->
          </div>
        </div>

        <!-- Sidebar phải -->
        <div class="col-lg-3 col-md-4 d-none d-md-block">
          <div
            class="right-sidebar full-height-sidebar"
            style="background-color: transparent"
          >
            <div class="d-flex justify-content-between contact-header mb-2">
              <div><strong>Người liên hệ</strong></div>
              <div class="d-flex">
                <div
                  class="rounded-circle contact-icon d-flex justify-content-center align-items-center"
                >
                  <i class="bi bi-search"></i>
                </div>
                <div
                  class="rounded-circle contact-icon d-flex justify-content-center align-items-center ms-2"
                >
                  <i class="bi bi-three-dots"></i>
                </div>
              </div>
            </div>
            <hr />
            <div id="friendList" class="flex-column gap-2"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap & Dark Mode JS -->

    <script>
      const menuItems = document.querySelectorAll("#menuTabs .menu-item");

      menuItems.forEach((item) => {
        item.addEventListener("click", () => {
          // Xoá active ở tất cả
          menuItems.forEach((el) => el.classList.remove("active"));
          // Thêm active vào phần tử vừa click
          item.classList.add("active");

          // Lấy đường dẫn từ thuộc tính data-link và chuyển trang
          const link = item.getAttribute("data-link");
          if (link) {
            window.location.href = link;
          }
        });
      });
    </script>

    <script>
      document.querySelectorAll(".toggle-comment").forEach((btn) => {
        btn.addEventListener("click", () => {
          const commentSection = btn
            .closest(".post")
            .querySelector(".comment-section");
          commentSection.classList.toggle("d-none");
        });
      });
      function autoResize(textarea) {
        textarea.style.height = "auto"; // Reset chiều cao
        textarea.style.height = textarea.scrollHeight + "px"; // Cập nhật chiều cao theo nội dung
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../Js/model.js"></script>

    <div class="modal fade" id="postModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" style="max-width: 500px">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title w-100 text-center" style="font-weight: bold">
              Tạo bài viết
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div class="d-flex align-items-center">
              <img
                src="../images/OIP.jpg"
                alt="Avatar"
                class="rounded-circle me-2 userAvatar"
                style="
                  width: 40px;
                  height: 40px;
                  border: 2px solid #fff;
                  box-shadow: 0 0 0 1px #ddd;
                "
              />

              <div>
                <strong class="userName">Nguyễn Văn A</strong>
                <!-- Dropdown chọn chế độ hiển thị -->
                <div class="dropdown">
                  <button
                    class="btn btn-light border dropdown-toggle d-flex align-items-center px-2 py-1 mt-1"
                    type="button"
                    id="privacyDropdown"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                    style="font-size: 10px; border-radius: 15px"
                  >
                    <i class="bi bi-globe me-1"></i>
                    <span id="privacyLabel">Công khai</span>
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="privacyDropdown">
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="setPrivacy('public')"
                      >
                        <i class="bi bi-globe me-2"></i> Công khai
                      </a>
                    </li>
                    <li>
                      <a
                        class="dropdown-item"
                        href="#"
                        onclick="setPrivacy('private')"
                      >
                        <i class="bi bi-lock-fill me-2"></i>Riêng tư
                      </a>
                    </li>
                  </ul>
                  <input
                    type="hidden"
                    id="privacyValue"
                    name="privacy"
                    value="public"
                  />
                </div>
              </div>
            </div>

            <!-- Nội dung bài viết -->
            <div style="overflow-y: auto; max-height: 450px">
              <div style="margin: 20px 0">
                <textarea
                  id="postContent"
                  class="form-control"
                  placeholder="What's on your mind?"
                  style="
                    overflow: hidden;
                    resize: none;
                    min-height: 38px;
                    line-height: 1.5;
                    border-radius: 8px;
                    padding: 8px;
                    font-size: 16px;
                    background-color: #f8f9fa;
                  "
                  oninput="autoResize(this)"
                ></textarea>
              </div>

              <!-- Khu vực preview ảnh -->
              <div
                id="imagePreviewContainer"
                class="d-none d-flex flex-wrap gap-2 mt-3 rounded-3"
                style="height: 350px"
              ></div>
            </div>

            <!-- nhập -->
            <div>
              <div></div>
              <div></div>
            </div>
            <!-- Input bị ẩn Ảnh hoặc video-->
            <div
              class="rounded-3 d-flex"
              style="
                background-color: #f8f9fa;
                height: 50px;
                border: 0.5px solid #bdc3c7;
                margin-top: 5px;
                align-items: center;
                justify-content: space-between;
                margin-top: 10p;
              "
            >
              <p style="margin: auto 10px">Add to your post</p>
              <input
                type="file"
                id="fileInput"
                class="d-none"
                accept="image/*,video/*"
                multiple
                onchange="handleMultipleImages(this)"
              />

              <!-- Label hiển thị icon -->
              <label for="fileInput" style="cursor: pointer; margin: 0 10px">
                <i class="bi bi-image fs-4" style="color: #2ecc71"></i>
                <!-- Icon hình ảnh Bootstrap -->
              </label>
            </div>
          </div>

          <div class="modal-footer">
            <button
              id="postBtn"
              class="btn btn-primary w-100"
              onclick="submitPost()"
            >
              <span id="postBtnText">Post</span>
              <span
                id="postBtnSpinner"
                class="spinner-border spinner-border-sm d-none ms-2"
                role="status"
                aria-hidden="true"
              ></span>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div
      id="successToast"
      class="toast align-items-center text-white bg-success border-0 position-fixed bottom-0 end-0 m-4"
      role="alert"
      aria-live="assertive"
      aria-atomic="true"
      style="z-index: 9999"
    >
      <div class="d-flex">
        <div class="toast-body">
          <i class="bi bi-check-circle-fill me-2"></i> Đăng bài viết thành công!
        </div>
        <button
          type="button"
          class="btn-close btn-close-white me-2 m-auto"
          data-bs-dismiss="toast"
          aria-label="Close"
        ></button>
      </div>
    </div>
    <div id="customSuccessModal" class="success-modal d-none">
      <div class="success-modal-content">
        <div class="success-icon">
          <i class="bi bi-check-lg"></i>
        </div>
        <h3 class="mt-3">Thành công!</h3>
        <p>Bài viết của bạn đã được đăng.</p>
        <button onclick="closeSuccessModal()">OK</button>
      </div>
    </div>

    <!-- Modal xem ảnh -->
    <!-- Modal toàn màn hình -->
    <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-fullscreen">
        <div class="modal-content border-0">
          <div class="modal-body p-0 d-flex" style="height: 100vh">
            <!-- Cột ảnh -->
            <div
              class="d-flex justify-content-center align-items-center position-relative flex-grow-1"
              style="width: 75%; background-color: #000"
            >
              <!-- Nút đóng -->
              <button
                type="button"
                class="btn-close btn-close-white position-absolute top-0 end-0 m-3 rounded-circle btn-light"
                data-bs-dismiss="modal"
                aria-label="Close"
                style="background-color: #bdc3c7; width: 30px; height: 30px"
              ></button>

              <!-- Ảnh lớn -->
              <img
                id="modalImage"
                src="../images/user-default.webp"
                alt="Ảnh phóng to"
                class="img-fluid"
                style="max-height: 100vh; object-fit: contain"
              />
            </div>

            <!-- Cột thông tin -->
            <div
              class="modal-info flex-shrink-0 d-flex flex-column position-relative"
              style="width: 25%; height: 100vh"
            >
              <div
                class="post shadow-sm p-3 rounded mb-3"
                style="padding-bottom: 80px"
              >
                <div class="d-flex justify-content-between">
                  <div class="d-flex align-items-center mb-2">
                    <img
                      src="../images/user-default.webp"
                      class="rounded-circle me-2"
                      style="
                        width: 40px;
                        height: 40px;
                        border: 1px solid #bdc3c7;
                      "
                      alt="Avatar"
                      id="profile_image"
                    />
                    <div>
                      <strong id="post-userName"></strong><br />
                      <small class="text-muted" id="postTime"
                        >2 giờ trước</small
                      >
                    </div>
                  </div>
                  <div
                    class="action-icon d-flex justify-content-center align-items-center rounded-circle"
                    style="width: 30px; height: 30px; cursor: pointer"
                    title="Tùy chọn"
                  >
                    <i class="bi bi-three-dots"></i>
                  </div>
                </div>
                <p class="post-text" id="postContentID"></p>

                <div
                  class="d-flex justify-content-around mt-5 border-top pt-2 position-relative"
                >
                  <div class="like-wrapper position-relative w-100 me-1">
                    <button
                      class="btn btn-light w-100 btn-action like-btn"
                      style="font-weight: bold; color: #65676b; font-size: 13px"
                    >
                      <i class="fa-solid fa-thumbs-up"></i>
                      Thích
                    </button>

                    <div
                      class="reaction-popup d-flex gap-2 rounded-5 shadow border"
                    >
                      <span class="icon" data-emotion="LIKE">
                        <img
                          src="../images/Animation/like.gif"
                          alt="Like"
                          class="reaction-img"
                        />
                      </span>
                      <span class="icon" data-emotion="LOVE"
                        ><img
                          src="../images/Animation/Emojis - Love (1).gif"
                          alt=""
                          style="width: 40px; height: 40px"
                      /></span>
                      <span class="icon" data-emotion="HAHA"
                        ><img
                          src="../images/Animation/smiley emoji 2.gif"
                          alt=""
                          style="width: 50px; height: 50px"
                      /></span>
                      <span class="icon" data-emotion="WOW"
                        ><img
                          src="../images/Animation/Emojis - Wow.gif"
                          alt=""
                          style="width: 40px; height: 40px"
                      /></span>
                      <span class="icon" data-emotion="SAD"
                        ><img
                          src="../images/Animation/Sad Emoji.gif"
                          alt=""
                          style="width: 50px; height: 50px"
                      /></span>
                      <span class="icon" data-emotion="ANGRY"
                        ><img
                          src="../images/Animation/Angry emoji.gif"
                          alt=""
                          style="width: 35px; height: 35px"
                      /></span>
                    </div>
                  </div>

                  <button
                    class="btn btn-light w-100 me-1 btn-action toggle-comment"
                    style="font-weight: bold; color: #65676b; font-size: 13px"
                  >
                    <i class="bi bi-chat-left"></i> Bình luận
                  </button>

                  <button
                    class="btn btn-light w-100 btn-action"
                    style="font-weight: bold; color: #65676b; font-size: 13px"
                  >
                    <i class="bi bi-share"></i> Chia sẻ
                  </button>
                </div>
              </div>

              <!-- Danh sách bình luận -->
              <div
                id="commentList"
                class="p-3 flex-grow-1 overflow-auto"
                style="
                  height: calc(100vh - 350px - 80px);
                  max-height: 430px;
                  margin-bottom: 90px;
                "
              >
                <!-- Các bình luận sẽ được render ở đây -->
              </div>

              <!-- Ô nhập bình luận cố định -->
              <div
                class="position-absolute d-flex bottom-0 start-0 end-0 bg-white border-top p-3 dark-mode-bg dark-mode-border"
              >
                <img
                  src="../images/user-default.webp"
                  alt="Avatar"
                  style="
                    width: 35px;
                    height: 35px;
                    border-radius: 50%;
                    margin-right: 5px;
                    border: 2px solid #fff; /* viền trắng */
                    box-shadow: 0 0 0 1px #ccc; /* outline xám nhạt */
                  "
                  class="userAvatar"
                />

                <div
                  class="container d-block gap-2 align-items-end rounded-3 p-2 dark-mode-input-container"
                  style="background-color: #f0f2f5"
                >
                  <textarea
                    id="commentInput"
                    class="form-control dark-mode-textarea"
                    placeholder="Bình luận..."
                    rows="1"
                    style="
                      max-height: 292px;
                      overflow-y: auto;
                      resize: none;
                      padding: 10px 0;
                      border: none;
                      background-color: transparent;
                    "
                    oninput="autoGrow(this)"
                  ></textarea>
                  <div
                    class="d-flex justify-content-between align-items-center mb-1"
                  >
                    <!-- Emoji Icon -->
                    <div
                      class="d-flex justify-content-center align-items-center rounded-circle icon-hover-dark"
                      style="width: 30px; height: 30px; cursor: pointer"
                    >
                      <i
                        class="bi bi-emoji-smile text-dark dark-mode-icon"
                        style="font-size: 15px"
                      ></i>
                    </div>

                    <!-- Send Icon -->
                    <div
                      class="d-flex justify-content-center align-items-center rounded-circle icon-hover-dark"
                      style="width: 30px; height: 30px; cursor: pointer"
                      id="sendCommentBtn"
                    >
                      <i
                        class="bi bi-send-fill text-dark dark-mode-icon"
                        style="font-size: 15px"
                      ></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- AI Assistant Button -->
    <!-- AI Assistant Button with Gradient Border -->
    <!-- <div
      style="
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60x;
        padding: 3px; /* viền giả */
        background: conic-gradient(
          from 0deg,
          #ff0080,
          #7928ca,
          #2afadf,
          #ff0080
        );
        border-radius: 50%;
        z-index: 9999;
        cursor: pointer;
      "
      onclick="window.location.href='chatbot.html'"
      id="ai"
    >
      <div
        style="
          width: 100%;
          height: 100%;
          background-color: white; /* màu nền bên trong */
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
        "
      >
        <img
          src="../images/OIP.webp"
          alt="Trợ lý ảo"
          style="
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
          "
        />
      </div>
    </div> -->
    <div
      style="
        position: fixed;
        bottom: 20px;
        right: 20px;

        z-index: 9999;
        cursor: pointer;
      "
      onclick="window.location.href='chatbot.html'"
      id="ai"
    >
      <img
        src="../images/Animation/CHOP Robot.gif"
        style="width: 60px; height: 60x"
        alt=""
      />
    </div>
    <!-- Khung chat nhỏ hiện khi chọn bạn bè -->
    <div
      id="chatBox"
      class="position-fixed bottom-0 end-0"
      style="width: 380px; display: none; z-index: 9999"
    >
      <div
        class="card shadow border-0 d-flex flex-column"
        style="height: 550px; border-radius: 18px; overflow: hidden"
      >
        <!-- Header -->
        <div
          class="card-header d-flex justify-content-between align-items-center p-2"
          style="
            background: linear-gradient(90deg, #6a11cb, #2575fc);
            color: #fff;
          "
        >
          <div class="d-flex align-items-center">
            <img
              id="friendAvatar"
              src="../images/user-default.webp"
              alt="avatar"
              style="
                width: 40px;
                height: 40px;
                border-radius: 50%;
                border: 2px solid #fff;
                cursor: pointer;
              "
            />
            <span
              id="friendName"
              class="ms-2 fw-semibold"
              style="cursor: pointer"
              >Người dùng</span
            >
          </div>
          <button
            id="closeChatBtn"
            class="btn btn-sm btn-light rounded-circle border-0"
            style="width: 32px; height: 32px; line-height: 1"
          >
            ✕
          </button>
        </div>

        <!-- Messages -->
        <div
          class="card-body flex-grow-1 overflow-auto px-3 py-2"
          id="chatMessages"
          style="background-color: #f9fafb"
        ></div>

        <!-- Footer / Input -->
        <div
          class="card-footer p-2 d-flex align-items-center gap-2"
          style="background-color: #fff"
        >
          <!-- Upload icon -->
          <button
            class="btn btn-light d-flex align-items-center justify-content-center shadow-sm rounded-circle"
            style="width: 40px; height: 40px"
          >
            <i class="bi bi-images fs-5 text-success"></i>
          </button>

          <!-- Input -->
          <textarea
            id="chatInput"
            class="form-control rounded-pill px-3"
            placeholder="Nhập tin nhắn..."
            rows="1"
            style="
              resize: none;
              max-height: 140px;
              min-height: 45px;
              font-family: inherit;
              background-color: #f1f3f5;
            "
          ></textarea>

          <!-- Send button -->
          <button
            class="btn btn-primary d-flex align-items-center justify-content-center shadow-sm rounded-circle"
            style="width: 40px; height: 40px"
            onclick="sendMessage()"
          >
            <i class="bi bi-send-fill fs-6"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Modal hiển thị tất cả ảnh và bình luận -->
    <div
      class="modal fade"
      id="allImagesModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered" style="max-width: 700px">
        <div
          class="modal-content"
          style="height: 90vh; display: flex; flex-direction: column"
        >
          <!-- Modal Body Cuộn được -->
          <div
            class="modal-body"
            style="overflow-y: auto; flex: 1; padding-bottom: 16px"
          >
            <!-- Thông tin người đăng -->
            <div class="d-flex align-items-center mb-3">
              <img
                id="allImagesAvatar"
                src="../images/user-default.webp"
                alt="Avatar"
                class="rounded-circle me-2"
                style="width: 40px; height: 40px; object-fit: cover"
              />
              <div>
                <strong id="allImagesName">Tên người dùng</strong><br />
                <small id="allImagesTime">...</small>
              </div>
            </div>

            <!-- Nội dung bài viết -->
            <p id="allImagesContent" class="mb-3"></p>

            <!-- Ảnh & Video -->
            <div id="mediaWrapper" class="mb-3">
              <div id="allImagesGrid"></div>
              <div id="allVideosGrid" class="mt-2"></div>
            </div>

            <hr />

            <!-- Danh sách bình luận -->
            <div id="commentListAll" class="mb-3"></div>
            <div
              id="noCommentPlaceholder"
              class="text-center text-muted my-4"
              style="display: none"
            >
              <i class="bi bi-chat-left-text" style="font-size: 2rem"></i>
              <p class="mt-2 mb-0">No comments yet</p>
            </div>
          </div>

          <!-- Ô nhập bình luận (Cố định) -->
          <div
            class="d-flex bg-white border-top p-3 dark-mode-bg dark-mode-border"
          >
            <img
              src="../images/IMG_2007.JPG"
              alt="Avatar"
              style="
                width: 35px;
                height: 35px;
                border-radius: 50%;
                margin-right: 5px;
                border: 2px solid #fff; /* viền trắng */
                box-shadow: 0 0 0 1px #ccc; /* outline xám nhạt */
              "
              class="userAvatar"
            />

            <div
              class="container d-block gap-2 align-items-end rounded-3 p-2 dark-mode-input-container"
              style="background-color: #f0f2f5"
            >
              <textarea
                id="commentInput"
                class="form-control dark-mode-textarea"
                placeholder="Write a comment..."
                rows="1"
                style="
                  max-height: 292px;
                  overflow-y: auto;
                  resize: none;
                  padding: 10px 0;
                  border: none;
                  background-color: transparent;
                "
                oninput="autoGrow(this)"
              ></textarea>
              <div
                class="d-flex justify-content-between align-items-center mb-1"
              >
                <!-- Emoji Icon -->
                <div
                  class="d-flex justify-content-center align-items-center rounded-circle icon-hover-dark"
                  style="width: 30px; height: 30px; cursor: pointer"
                >
                  <i
                    class="bi bi-emoji-smile text-dark dark-mode-icon"
                    style="font-size: 15px"
                  ></i>
                </div>

                <!-- Send Icon -->
                <div
                  class="d-flex justify-content-center align-items-center rounded-circle icon-hover-dark"
                  style="width: 30px; height: 30px; cursor: pointer"
                  id="sendCommentBtn"
                >
                  <i
                    class="bi bi-send-fill text-dark dark-mode-icon"
                    style="font-size: 15px"
                  ></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="../Js/comment.js"></script>
  </body>
  <script src="../Js/api-post.js"></script>
  <script>
    function autoGrow(textarea) {
      textarea.style.height = "auto"; // reset trước
      textarea.style.height = textarea.scrollHeight + "px";
    }
  </script>
  <!-- CDN SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="../Js/socket.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
  <script src="../Js/mess.js"></script>
  <script src="../Js/token.js"></script>
  <script src="../Js/api-get-story.js"></script>
  <script src="../Js/story.js"></script>
  <script src="../Js/api-get-friends.js"></script>
  <script src="../Js/get_friends-chat.js"></script>
  <script src="../Js/api-reaction.js"></script>
  <script src="../Js/api-chat-friends.js"></script>
  <script src="../Js/notification.js"></script>
  <!-- ✅ Tải STOMP sau -->
  <script></script>
  <script src="https://unpkg.com/lottie-web/build/player/lottie.min.js"></script>
  <script src="../Js/api-share-save-post.js"></script>
  <script>
    const menuToggle = document.getElementById("menuToggle");
    const menuDropdown = document.getElementById("menuDropdown");

    menuToggle.addEventListener("click", function (e) {
      e.stopPropagation(); // Ngăn sự kiện lan ra ngoài
      const isVisible = menuDropdown.style.display === "block";
      menuDropdown.style.display = isVisible ? "none" : "block";
    });

    // Click ngoài thì ẩn menu
    document.addEventListener("click", function () {
      menuDropdown.style.display = "none";
    });
  </script>
  <script>
    const darkModeRadios = document.querySelectorAll('input[name="darkmode"]');

    function setDarkMode(isOn) {
      if (isOn) {
        document.body.classList.add("dark-mode");
        localStorage.setItem("darkMode", "on");
      } else {
        document.body.classList.remove("dark-mode");
        localStorage.setItem("darkMode", "off");
      }
    }

    // Khi load trang, set radio và class body theo trạng thái lưu
    window.addEventListener("DOMContentLoaded", () => {
      const darkModeStatus = localStorage.getItem("darkMode") || "off";
      setDarkMode(darkModeStatus === "on");

      darkModeRadios.forEach((radio) => {
        radio.checked = radio.value === darkModeStatus;
      });
    });

    // Bắt sự kiện thay đổi radio để bật/tắt dark mode
    darkModeRadios.forEach((radio) => {
      radio.addEventListener("change", () => {
        setDarkMode(radio.value === "on");
      });
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</html>
